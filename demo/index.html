<!doctype html>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <title>exchange-timeline Demo</title>
    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <link rel="import" href="../exchange-timeline.html">
  </head>
  <body unresolved>


    <exchange-timeline access_token="9xMaEW1CW4K3RQEvFcsztQ))" key="XGiATUM3eJCNfJviQBxefw((" site="stackoverflow.com">
    </exchange-timeline>

    <script>
      document.addEventListener('WebComponentsReady', function(){
        setTimeout(function(){
          var all_elements = document.querySelector('exchange-timeline').getElementsByTagName('*')
          var functions= {
            '1.4.7': function(callback){
              var audioList = document.getElementsByTagName('audio');
              var copyList = [];

              var search = function(list, item){
                var finded = false;
                var i=-1;
                var elem;
                for(i=0;i<list.length && !finded;i++){
                  if (list[i] == item){
                    finded = true;
                    elem = list[i];
                  }
                }
                return --i;
              }
              var playCallback = function(e){
                var elem = e.target;
                elem.setAttribute('data-count-play',1);
                var index = search(audioList, elem)
                if (index>-1 && audioList[index].getAttribute('data-count-pause') == 1){
                  var position = search(copyList, index)
                  if ( position >-1){
                    copyList.splice(position, 1);
                  }
                }
              }.bind(this);
              var pauseCallback = function(e){
                var elem = e.target;
                elem.setAttribute('data-count-pause',1);
                var index = search(audioList, elem)
                if (index>-1 && audioList[index].getAttribute('data-count-pause') == 1){
                  var position = search(copyList, index)
                  if ( position >-1){
                    copyList.splice(position, 1);
                  }
                }
              }.bind(this);

              for(i=0;i<audioList.length;i++){
                audioList[i].onplay = playCallback;
                audioList[i].onpause = pauseCallback;
                copyList.push(i);
              }

              for(i=0;i<all_elements.length*2 && audioList.length > 0;i++){
                elem = all_elements[i%all_elements.length];
                if (elem.click && elem.tagName != 'A'){
                  elem.click();
                }
              }
              setTimeout(function(){
                callback(copyList.length == 0);
              },300)

            }
          }
          functions["1.4.7"](function(cumple){
            console.log('Cumple el 1.4.7', cumple);  
          });


        },2000);
      })
    </script>

  </body>
</html>
